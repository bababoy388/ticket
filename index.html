<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Билет - Городской Транспорт</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            background-color: #212d3b;
            color: rgba(255, 255, 255, 0.85);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Верхняя часть - фон для билета */
        .ticket-background {
            background-color: #212d3b;
            width: 100%;
            padding: 10px 16px 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            justify-content: flex-start;
        }

        /* Нижняя часть - темный фон под кнопкой */
        .button-section {
            background-color: #151e27;
            width: 100%;
            padding: 8px 16px 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0;
        }

        .tabs-container {
            background-color: transparent;
            border-bottom: none;
            position: relative;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 5px;
        }

        .tabs {
            display: flex;
            padding: 8px 16px 0;
            gap: 8px;
            position: relative;
            min-width: min-content;
            width: max-content;
            margin: 0 auto;
        }

        .tab {
            flex: 0 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 16px 16px;
            font-size: 16px !important;
            font-weight: 500;
            background: transparent;
            border: none;
            border-radius: 0;
            color: rgba(255, 255, 255, 0.85);
            cursor: pointer;
            gap: 8px;
            position: relative;
            transition: color 0.2s ease;
            white-space: nowrap;
            min-width: max-content;
        }

        .tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0;
            background-color: #e21a1a;
            transition: height 0.2s ease;
            border-radius: 2px 2px 0 0;
        }

        .tab.active {
            background: transparent;
            color: #e21a1a;
            font-weight: 600;
        }

        .tab.active::after {
            height: 3px;
        }

        .tab-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 27px;
            height: 27px;
            transition: fill 0.2s ease;
            flex-shrink: 0;
        }

        .tab-icon svg {
            width: 100%;
            height: 100%;
            fill: rgba(255, 255, 255, 0.85);
            transition: fill 0.2s ease;
        }

        .tab.active .tab-icon svg {
            fill: #e21a1a;
        }

        .ticket-container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            word-wrap: break-word;
            word-break: normal;
            overflow-wrap: anywhere;
        }

        .ticket {
            background-color: transparent;
            border-radius: 0;
            overflow: visible;
            box-shadow: none;
            margin-bottom: 0;
        }

        .header {
            background-color: transparent;
            color: rgba(255, 255, 255, 0.85);
            padding: 0 16px 5px;
            text-align: center;
            border-bottom: none;
            margin-top: 0;
        }

        .header h1 {
            font-size: 25px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        /* Стили для основного контента */
        .main-content {
            padding: 16px;
            display: block;
        }

        .main-content.hidden {
            display: none;
        }

        /* Стили для контента контроля (QR-код) */
        .control-content {
            padding: 16px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .control-content.active {
            display: flex;
        }

        .row-block {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(58, 72, 89, 0.7);
            min-width: 100%;
            max-width: 100%;
            overflow-wrap: break-word;
        }

        .row-block-icon {
            margin-right: 12px;
            margin-top: 2px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
        }

        .row-block-icon svg {
            width: 30px;
            height: 30px;
            fill: rgba(255, 255, 255, 0.85);
        }

        .row-block-content {
            flex: 1;
            min-width: 0;
            word-wrap: break-word;
            word-break: normal;
            overflow-wrap: break-word;
            max-width: calc(100% - 48px);
            width: auto;
        }

        .row-block .label {
            font-size: 16px;
            color: rgba(142, 142, 147, 0.85);
            margin-bottom: 4px;
            word-break: keep-all;
        }

        .row-block .route-number {
            color: rgba(255, 255, 255, 0.85);
            font-size: 22px;
            font-weight: 500;
            letter-spacing: normal;
            word-wrap: break-word;
            word-break: normal;
            overflow-wrap: break-word;
            hyphens: auto;
            line-height: 1.3;
            max-width: 100%;
            display: inline-block;
        }

        /* Стили для QR-кода */
        .qr-image {
            max-width: 320px;
            width: 100%;
            height: auto;
            margin: 5px auto;
            display: block;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .qr-number-display {
            font-size: 30px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
            margin-top: 25px;
            letter-spacing: 1.5px;
            padding: 15px 25px;
            display: inline-block;
        }

        .control-notice {
            font-size: 15px;
            color: rgba(142, 142, 147, 0.85);
            margin-top: 20px;
            max-width: 300px;
            line-height: 1.5;
            text-align: center;
        }

        .close-btn {
            background-color: rgba(226, 26, 26, 1) !important;
            color: rgba(255, 255, 255, 1) !important;
            border: none;
            width: 100%;
            max-width: 360px;
            padding: 14px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 10px;
            transition: opacity 0.2s;
            margin: 0;
            display: block;
        }

        .close-btn:active {
            opacity: 0.7;
        }

        .timer {
            text-align: center;
            margin-top: 16px;
            font-size: 14px;
            color: rgba(142, 142, 147, 0.85);
        }

        .timer-value {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.85);
        }

        @keyframes pulse {
            0% { opacity: 0.85; }
            50% { opacity: 0.6; }
            100% { opacity: 0.85; }
        }

        .timer.pulse {
            animation: pulse 1s infinite;
        }

        .tg-back-button {
            display: none;
        }

        /* Стили для скроллбара в табах */
        .tabs-container::-webkit-scrollbar {
            height: 3px;
        }

        .tabs-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .tabs-container::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .tabs-container::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 500px) {
            .ticket-container {
                max-width: 100%;
            }

            .close-btn {
                border-radius: 10px;
                max-width: 100%;
            }

            .tabs {
                padding: 8px 12px 0;
            }

            .tab {
                padding: 10px 14px 14px;
            }

            .row-block .route-number {
                font-size: 19px;
                line-height: 1.2;
            }

            .row-block-content {
                max-width: calc(100% - 40px);
            }

            .qr-image {
                max-width: 240px;
            }

            .qr-number-display {
                font-size: 22px;
                padding: 12px 20px;
            }
        }

        @media (max-width: 380px) {
            .tabs {
                gap: 6px;
            }

            .tab {
                padding: 10px 12px 14px;
            }

            .row-block-content {
                max-width: calc(100% - 36px);
            }

            .qr-image {
                max-width: 210px;
            }

            .qr-number-display {
                font-size: 20px;
                padding: 10px 18px;
            }
        }

        @media (max-width: 340px) {
            .tabs {
                gap: 4px;
            }

            .tab {
                padding: 10px 10px 14px;
            }
        }

        /* Специальные стили для увеличения области маршрута */
        #bus {
            display: inline-block;
            max-width: 100%;
            word-wrap: break-word;
            word-break: normal;
            overflow-wrap: break-word;
        }
    </style>
</head>
<body>
    <!-- Верхняя часть - фон для билета -->
    <div class="ticket-background">
        <div class="ticket-container">
            <div class="ticket">
                <!-- Заголовок теперь ближе к верхней границе -->
                <div class="header">
                    <h1>Действует: <span id="timer">15</span> сек.</h1>
                </div>

                <div class="tabs-container">
                    <div class="tabs">
                        <button class="tab active" data-tab="number">
                            <span class="tab-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><title>Document-one-page-add-20-regular SVG Icon</title><path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h4.257a5.5 5.5 0 0 1-.657-1H6a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v5.022q.516.047 1 .185V4a2 2 0 0 0-2-2m-1 4.5a.5.5 0 0 1-.41.492L12.5 7h-5a.5.5 0 0 1-.09-.992L7.5 6h5a.5.5 0 0 1 .5.5M14.5 19a4.5 4.5 0 1 0 0-9a4.5 4.5 0 0 0 0 9m0-7a.5.5 0 0 1 .5.5V14h1.5a.5.5 0 0 1 0 1H15v1.5a.5.5 0 0 1-1 0V15h-1.5a.5.5 0 0 1 0-1H14v-1.5a.5.5 0 0 1 .5-.5m-7-2h3.837c-.403.284-.767.62-1.08 1H7.5a.5.5 0 0 1 0-1"/></svg>
                            </span>
                            <span>1&nbsp;326&nbsp;741&nbsp;863</span>
                        </button>
                        <button class="tab" data-tab="control">
                            <span class="tab-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><title>User-police SVG Icon</title><path fill="none" stroke="currentColor" stroke-width="2" d="M16 14c2.374 1.183 4 3.65 4 7v2H4v-2c0-3.354 1.631-5.825 4-7m4 1c3.26 0 5.903-2.686 5.903-5.999c0-.702.218-1.375 0-2.001M6.093 7c-.21.615 0 1.313 0 2.001C6.093 12.314 8.738 15 12 15M6 8h12l3-4c-1.912-1.735-5.21-3-9-3c-3.836 0-7.168 1.296-9 3zm6-3a1 1 0 0 0 1-1h-2a1 1 0 0 0 1 1z"/></svg>
                            </span>
                            <span>Контроль</span>
                        </button>
                    </div>
                </div>

                <!-- Основной контент (детали билета) -->
                <div class="main-content" id="main-content">
                    <div class="row-block">
                        <div class="row-block-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><title>User-police SVG Icon</title><path fill="none" stroke="currentColor" stroke-width="2" d="M16 14c2.374 1.183 4 3.65 4 7v2H4v-2c0-3.354 1.631-5.825 4-7m4 1c3.26 0 5.903-2.686 5.903-5.999c0-.702.218-1.375 0-2.001M6.093 7c-.21.615 0 1.313 0 2.001C6.093 12.314 8.738 15 12 15M6 8h12l3-4c-1.912-1.735-5.21-3-9-3c-3.836 0-7.168 1.296-9 3zm6-3a1 1 0 0 0 1-1h-2a1 1 0 0 0 1 1z"/></svg>
                        </div>
                        <div class="row-block-content">
                            <div class="label">Перевозчик</div>
                            <div class="route-number" id="company">ООО "СКАД"</div>
                        </div>
                    </div>

                    <div class="row-block">
                        <div class="row-block-icon">
                            <svg viewBox="0 0 576 512" width="24" height="24">
    <path d="M144 336C144 318.3 158.3 304 176 304C193.7 304 208 318.3 208 336C208 353.7 193.7 368 176 368C158.3 368 144 353.7 144 336zM368 336C368 318.3 382.3 304 400 304C417.7 304 432 318.3 432 336C432 353.7 417.7 368 400 368C382.3 368 368 353.7 368 336zM74.2 70.03C99.86 38.75 167.8 0 288 0C416.6 0 478 38.63 502.4 70.55C509.9 80.32 512 91.48 512 100.4V128C529.7 128 544 142.3 544 160V224C544 241.7 529.7 256 512 256V376C512 400.1 499.3 422.1 480 435.9V488C480 501.3 469.3 512 456 512C442.7 512 432 501.3 432 488V448H144V488C144 501.3 133.3 512 120 512C106.7 512 96 501.3 96 488V435.9C76.7 422.1 64 400.1 64 376V256C46.33 256 32 241.7 32 224V160C32 142.3 46.33 128 64 128V100.4C64 91.58 66.05 79.97 74.2 70.03zM363.7 96H461.2C445.4 78.89 399.2 48 288 48C185.8 48 133.8 78.27 115.5 96H212.3C217.8 86.44 228.2 80 240 80H336C347.8 80 358.2 86.44 363.7 96zM464 144H312V224H464V144zM112 224H264V144H112V224zM112 272V376C112 389.3 122.7 400 136 400H440C453.3 400 464 389.3 464 376V272H112z"/>
</svg>
                        </div>
                        <div class="row-block-content">
                            <div class="label" id="route">Маршрут</div>
                            <div class="route-number" id="bus">x164kx124</div>
                        </div>
                    </div>

                    <div class="row-block">
                        <div class="row-block-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><title>Ruble SVG Icon</title><path fill="#ffffff" d="M8 21h2v-3h6v-2h-6v-2h4.5c2.757 0 5-2.243 5-5s-2.243-5-5-5H9a1 1 0 0 0-1 1v7H5v2h3v2H5v2h3zm2-15h4.5c1.654 0 3 1.346 3 3s-1.346 3-3 3H10z"/></svg>
                        </div>
                        <div class="row-block-content">
                            <div class="label">Стоимость</div>
                            <div class="route-number">1 шт., Полный, 48.00 ₽</div>
                        </div>
                    </div>

                    <div class="row-block">
                        <div class="row-block-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                            </svg>
                        </div>
                        <div class="row-block-content">
                            <div class="label">Дата покупки</div>
                            <div class="route-number" id="date_buy">01 декабря 2025 г.</div>
                        </div>
                    </div>

                    <div class="row-block">
                        <div class="row-block-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                            </svg>
                        </div>
                        <div class="row-block-content">
                            <div class="label">Время покупки</div>
                            <div class="route-number" id="time_buy">20:40</div>
                        </div>
                    </div>
                </div>

                <!-- Контент для контроля (QR-код) -->
                <div class="control-content" id="control-content">
                    <img src="static/photo/qr.jpg" alt="QR-код билета" class="qr-image">
                    <div class="qr-number-display">№ 1 326 741 863</div>

                </div>
            </div>
        </div>
    </div>

    <!-- Нижняя часть - темный фон под кнопкой -->
    <div class="button-section">
        <div class="ticket-container">
            <button class="close-btn" id="closeButton">ЗАКРЫТЬ</button>
        </div>
    </div>

    <script>
        // Функция для парсинга GET-параметров
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                arg1: params.get('arg1') || 'не указан аааааа аааааааа аааааааа',
                arg2: params.get('arg2') || 'не указан',
                date_buy: params.get('date_buy') || 'не указан',
                time_buy: params.get('time_buy') || 'не указан',
                company: params.get('company') || 'не указан'
            };
        }

        // Получаем параметры из URL
        const queryParams = getQueryParams();
        const routeNumber = queryParams.arg1;
        const busNumber = queryParams.arg2;
        const date_buy = queryParams.date_buy;
        const time_buy = queryParams.time_buy;
        const company = queryParams.company;

        // Инициализация Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Подставляем полученные параметры в нужные места
        document.getElementById('route').textContent = `${routeNumber}`;
        document.getElementById('bus').textContent = `${busNumber}`;
        document.getElementById('date_buy').textContent = `${date_buy}`;
        document.getElementById('time_buy').textContent = `${time_buy}`;
        document.getElementById('company').textContent = `${company}`;

        // Функция для переключения вкладок
        function switchTab(tabName) {
            // Переключаем активные кнопки табов
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                }
            });

            // Переключаем контент
            const mainContent = document.getElementById('main-content');
            const controlContent = document.getElementById('control-content');

            if (tabName === 'number') {
                mainContent.classList.remove('hidden');
                controlContent.classList.remove('active');
            } else if (tabName === 'control') {
                mainContent.classList.add('hidden');
                controlContent.classList.add('active');
            }

            // Прокручиваем к выбранному табу
            const activeTab = document.querySelector(`.tab[data-tab="${tabName}"]`);
            if (activeTab) {
                const tabsContainer = document.querySelector('.tabs-container');
                const tabOffset = activeTab.offsetLeft - tabsContainer.offsetWidth / 2 + activeTab.offsetWidth / 2;
                tabsContainer.scrollLeft = tabOffset;
            }
        }

        // Функция для корректировки переноса текста с увеличенной шириной для маршрута
        function adjustTextWrapping() {
            const busElement = document.getElementById('bus');
            const routeElements = document.querySelectorAll('.route-number');
            const rowBlockContents = document.querySelectorAll('.row-block-content');

            // Для всех элементов с классом route-number
            routeElements.forEach(element => {
                const text = element.textContent.trim();
                // Если текст содержит пробелы или короткий, разрешаем нормальный перенос
                if (text.includes(' ') || text.length < 15) {
                    element.style.wordBreak = 'normal';
                    element.style.overflowWrap = 'break-word';
                } else {
                    // Для длинных текстов без пробелов
                    element.style.wordBreak = 'break-word';
                    element.style.overflowWrap = 'anywhere';
                }
            });

            // Для содержимого блоков - увеличиваем максимальную ширину
            rowBlockContents.forEach(block => {
                block.style.minWidth = '0';
                block.style.overflowWrap = 'break-word';
                // Увеличиваем максимальную ширину для лучшего переноса
                block.style.maxWidth = 'calc(100% - 40px)';
            });

            // Специально для номера автобуса - увеличиваем максимальную ширину
            if (busElement) {
                busElement.style.maxWidth = '100%';
                busElement.style.display = 'inline-block';
                busElement.style.wordBreak = 'break-word';
                busElement.style.overflowWrap = 'break-word';

                // Увеличиваем шрифт для длинных текстов
                if (busElement.textContent.length > 10) {
                    busElement.style.fontSize = '22px';
                    busElement.style.lineHeight = '1.3';
                }
            }
        }

        // Инициализация таймера
        let timeLeft = 15;
        const timerElement = document.getElementById('timer');

        const countdown = setInterval(() => {
            timeLeft--;
            timerElement.textContent = timeLeft;

            if (timeLeft <= 0) {
                clearInterval(countdown);
                tg.close();
            }
        }, 1000);

        // Обработка кнопки закрытия
        document.getElementById('closeButton').addEventListener('click', function() {
            tg.close();
        });

        // Обработка кнопки "Назад" в Telegram
        tg.BackButton.onClick(function() {
            tg.close();
        });

        tg.BackButton.show();

        // Обработка переключения табов
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                switchTab(tabId);
            });
        });

        // Вызываем функцию настройки переноса текста
        window.addEventListener('load', adjustTextWrapping);
        window.addEventListener('resize', adjustTextWrapping);

        tg.ready();
    </script>
</body>
</html>