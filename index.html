<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Билет - Городской Транспорт</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            background-color: #212d3b;
            color: rgba(255, 255, 255, 0.85);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Верхняя часть - фон для билета */
        .ticket-background {
            background-color: #212d3b;
            width: 100%;
            padding: 10px 16px 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            justify-content: flex-start;
        }

        /* Нижняя часть - темный фон под кнопкой */
        .button-section {
            background-color: #151e27;
            width: 100%;
            padding: 8px 16px 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0;
        }

        .tabs-container {
            background-color: transparent;
            border-bottom: none;
            position: relative;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 5px;
        }

        .tabs {
            display: flex;
            padding: 8px 16px 0;
            gap: 8px;
            position: relative;
            min-width: min-content;
            width: max-content;
            margin: 0 auto;
        }

        .tab {
            flex: 0 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 16px 16px;
            font-size: 16px !important;
            font-weight: 500;
            background: transparent;
            border: none;
            border-radius: 0;
            color: rgba(255, 255, 255, 0.85);
            cursor: pointer;
            gap: 8px;
            position: relative;
            transition: color 0.2s ease;
            white-space: nowrap;
            min-width: max-content;
        }

        .tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0;
            background-color: #e21a1a;
            transition: height 0.2s ease;
            border-radius: 2px 2px 0 0;
        }

        .tab.active {
            background: transparent;
            color: #e21a1a;
            font-weight: 600;
        }

        .tab.active::after {
            height: 3px;
        }

        .tab-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 27px;
            height: 27px;
            transition: fill 0.2s ease;
            flex-shrink: 0;
        }

        .tab-icon svg {
            width: 100%;
            height: 100%;
            fill: rgba(255, 255, 255, 0.85);
            transition: fill 0.2s ease;
        }

        .tab.active .tab-icon svg {
            fill: #e21a1a;
        }

        .tab-content {
            padding: 16px;
        }

        .tab-pane {
            display: none;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.85);
        }

        .tab-pane.active {
            display: block;
        }

        .control-code {
            font-size: 16px;
            font-weight: 500;
            color: rgba(142, 142, 147, 0.85);
        }

        .ticket-container {
            width: 100%;
            max-width: 500px; /* Увеличил с 420px до 500px */
            display: flex;
            flex-direction: column;
            word-wrap: break-word;
            word-break: normal;
            overflow-wrap: anywhere;
        }

        .ticket {
            background-color: transparent;
            border-radius: 0;
            overflow: visible;
            box-shadow: none;
            margin-bottom: 0;
        }

        .header {
            background-color: transparent;
            color: rgba(255, 255, 255, 0.85);
            padding: 0 16px 5px;
            text-align: center;
            border-bottom: none;
            margin-top: 0;
        }

        .header h1 {
            font-size: 25px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .header .duration {
            font-size: 14px;
            opacity: 0.8;
        }

        .ticket-number {
            background-color: transparent;
            padding: 24px 16px;
            text-align: center;
            border-bottom: none;
        }

        .number {
            font-size: 28px;
            font-weight: 500;
            letter-spacing: normal;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 4px;
            word-spacing: normal;
            word-break: keep-all;
            overflow-wrap: normal;
        }

        .control {
            font-size: 16px;
            color: rgba(142, 142, 147, 0.85);
            font-weight: 500;
        }

        .details {
            padding: 8px 16px 12px;
        }

        .row-block {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(58, 72, 89, 0.7);
            min-width: 100%;
            max-width: 100%;
            overflow-wrap: break-word;
        }

        .row-block-icon {
            margin-right: 12px;
            margin-top: 2px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
        }

        .row-block-icon svg {
            width: 30px;
            height: 30px;
            fill: rgba(255, 255, 255, 0.85);
        }

        .row-block-content {
            flex: 1;
            min-width: 0;
            word-wrap: break-word;
            word-break: normal;
            overflow-wrap: break-word;
            /* Увеличиваем максимальную ширину для переноса */
            max-width: calc(100% - 48px); /* Учитываем ширину иконки + отступ */
            width: auto;
        }

        .row-block .label {
            font-size: 16px;
            color: rgba(142, 142, 147, 0.85);
            margin-bottom: 4px;
            word-break: keep-all;
        }

        .row-block .carrier-value {
            color: rgba(36, 129, 204, 0.9);
            font-size: 20px;
            font-weight: 600;
            word-break: normal;
        }

        .row-block .route-number {
            color: rgba(255, 255, 255, 0.85);
            font-size: 22px;
            font-weight: 500;
            letter-spacing: normal;
            word-wrap: break-word;
            word-break: normal;
            overflow-wrap: break-word;
            hyphens: auto;
            line-height: 1.3;
            /* Увеличиваем максимальную ширину для текста маршрута */
            max-width: 100%;
            display: inline-block;
        }

        .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 18px;
            padding-bottom: 18px;
            border-bottom: 1px solid rgba(58, 72, 89, 0.7);
        }

        .row:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .label {
            font-size: 14px;
            color: rgba(142, 142, 147, 0.85);
            width: 40%;
        }

        .value {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.85);
            font-weight: 500;
            width: 60%;
            text-align: right;
        }

        .carrier-value {
            color: rgba(36, 129, 204, 0.9);
            font-size: 17px;
        }

        .route {
            font-size: 17px;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.85);
        }

        .qr-section {
            text-align: center;
            margin: 20px 0;
            padding: 16px;
            background-color: transparent;
            border-radius: 0;
        }

        .qr-label {
            font-size: 14px;
            color: rgba(142, 142, 147, 0.85);
            margin-bottom: 8px;
        }

        .qr-code {
            font-size: 18px;
            letter-spacing: normal;
            padding: 12px;
            background-color: transparent;
            border-radius: 0;
            display: inline-block;
            color: rgba(255, 255, 255, 0.85);
        }

        .price {
            color: rgba(226, 26, 26, 0.9);
            font-size: 18px;
        }

        .date-time {
            display: flex;
            justify-content: space-between;
        }

        .date-time .label,
        .date-time .value {
            width: auto;
            text-align: left;
        }

        .date-time > div {
            width: 48%;
        }

        .close-btn {
            background-color: rgba(226, 26, 26, 1) !important;
            color: rgba(255, 255, 255, 1) !important;
            border: none;
            width: 100%;
            max-width: 360px;
            padding: 14px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 10px;
            transition: opacity 0.2s;
            margin: 0;
            display: block;
        }

        .close-btn:active {
            opacity: 0.7;
        }

        .timer {
            text-align: center;
            margin-top: 16px;
            font-size: 14px;
            color: rgba(142, 142, 147, 0.85);
        }

        .timer-value {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.85);
        }

        @keyframes pulse {
            0% { opacity: 0.85; }
            50% { opacity: 0.6; }
            100% { opacity: 0.85; }
        }

        .timer.pulse {
            animation: pulse 1s infinite;
        }

        .tg-back-button {
            display: none;
        }

        /* Стили для скроллбара в табах */
        .tabs-container::-webkit-scrollbar {
            height: 3px;
        }

        .tabs-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .tabs-container::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .tabs-container::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 500px) {
            .ticket-container {
                max-width: 100%;
            }

            .close-btn {
                border-radius: 10px;
                max-width: 100%;
            }

            .tabs {
                padding: 8px 12px 0;
            }

            .tab {
                padding: 10px 14px 14px;
            }

            .row-block .route-number {
                font-size: 19px;
                line-height: 1.2;
            }

            /* На маленьких экранах делаем контентный блок еще шире */
            .row-block-content {
                max-width: calc(100% - 40px); /* Уменьшаем отступ для иконки */
            }
        }

        @media (max-width: 380px) {
            .tabs {
                gap: 6px;
            }

            .tab {
                padding: 10px 12px 14px;
            }

            .row-block-content {
                max-width: calc(100% - 36px); /* Еще уменьшаем для очень узких экранов */
            }
        }

        @media (max-width: 340px) {
            .tabs {
                gap: 4px;
            }

            .tab {
                padding: 10px 10px 14px;
            }
        }

        /* Специальные стили для увеличения области маршрута */
        #bus {
            display: inline-block;
            max-width: 100%;
            word-wrap: break-word;
            word-break: normal;
            overflow-wrap: break-word;
        }

        .icons-x2 .tab-icon {
            width: 36px;
            height: 36px;
        }
        .icons-x2 .row-block-icon {
            width: 48px;
            height: 48px;
        }
        .icons-x2 .row-block-icon svg {
            width: 40px;
            height: 40px;
        }

        .icons-small .tab-icon {
            width: 18px;
            height: 18px;
        }
        .icons-small .row-block-icon {
            width: 24px;
            height: 24px;
        }
        .icons-small .row-block-icon svg {
            width: 20px;
            height: 20px;
        }

        .icons-blue .tab-icon svg,
        .icons-blue .row-block-icon svg {
            fill: rgba(36, 129, 204, 0.9);
        }

        .icons-red .tab-icon svg,
        .icons-red .row-block-icon svg {
            fill: rgba(226, 26, 26, 0.9);
        }

        .icons-green .tab-icon svg,
        .icons-green .row-block-icon svg {
            fill: rgba(46, 204, 113, 0.9);
        }
    </style>
</head>
<body>
    <!-- Верхняя часть - фон для билета -->
    <div class="ticket-background">
        <div class="ticket-container">
            <div class="ticket">
                <!-- Заголовок теперь ближе к верхней границе -->
                <div class="header">
                    <h1>Действует: <span id="timer">15</span> сек.</h1>
                </div>

                <div class="tabs-container">
                    <div class="tabs">
                        <button class="tab active" data-tab="number">
                            <span class="tab-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8l8 5 8-5v10zm-8-7L4 6h16l-8 5z"/>
                                </svg>
                            </span>
                            <span>1&nbsp;326&nbsp;741&nbsp;863</span>
                        </button>
                        <button class="tab" data-tab="control">
                            <span class="tab-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                                </svg>
                            </span>
                            <span>Контроль</span>
                        </button>
                    </div>
                </div>

                <div class="details">
                    <div class="row-block">
                        <div class="row-block-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/>
                            </svg>
                        </div>
                        <div class="row-block-content">
                            <div class="label">Перевозчик</div>
                            <div class="route-number" id="company">ООО "СКАД"</div>
                        </div>
                    </div>

                    <div class="row-block">
                        <div class="row-block-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5H15V3H9v2H6.5c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>
                            </svg>
                        </div>
                        <div class="row-block-content">
                            <div class="label" id="route">Маршрут</div>
                            <div class="route-number" id="bus">x164kx124</div>
                        </div>
                    </div>

                    <div class="row-block">
                        <div class="row-block-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                        </div>
                        <div class="row-block-content">
                            <div class="label">Стоимость</div>
                            <div class="route-number">1 шт., Полный, 48.00 ₽</div>
                        </div>
                    </div>

                    <div class="row-block">
                        <div class="row-block-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                            </svg>
                        </div>
                        <div class="row-block-content">
                            <div class="label">Дата покупки</div>
                            <div class="route-number" id="date_buy">01 декабря 2025 г.</div>
                        </div>
                    </div>

                    <div class="row-block">
                        <div class="row-block-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                            </svg>
                        </div>
                        <div class="row-block-content">
                            <div class="label">Время покупки</div>
                            <div class="route-number" id="time_buy">20:40</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Нижняя часть - темный фон под кнопкой -->
    <div class="button-section">
        <div class="ticket-container">
            <button class="close-btn" id="closeButton">ЗАКРЫТЬ</button>
        </div>
    </div>

    <script>
        // Функция для парсинга GET-параметров
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                arg1: params.get('arg1') || 'не указан аааааа аааааааа аааааааа',
                arg2: params.get('arg2') || 'не указан',
                date_buy: params.get('date_buy') || 'не указан',
                time_buy: params.get('time_buy') || 'не указан',
                company: params.get('company') || 'не указан'
            };
        }

        // Получаем параметры из URL
        const queryParams = getQueryParams();
        const routeNumber = queryParams.arg1;
        const busNumber = queryParams.arg2;
        const date_buy = queryParams.date_buy;
        const time_buy = queryParams.time_buy;
        const company = queryParams.company;

        // Инициализация Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Подставляем полученные параметры в нужные места
        document.getElementById('route').textContent = `${routeNumber}`;
        document.getElementById('bus').textContent = `${busNumber}`;
        document.getElementById('date_buy').textContent = `${date_buy}`;
        document.getElementById('time_buy').textContent = `${time_buy}`;
        document.getElementById('company').textContent = `${company}`;

        // Функция для корректировки переноса текста с увеличенной шириной для маршрута
        function adjustTextWrapping() {
            const busElement = document.getElementById('bus');
            const routeElements = document.querySelectorAll('.route-number');
            const rowBlockContents = document.querySelectorAll('.row-block-content');

            // Для всех элементов с классом route-number
            routeElements.forEach(element => {
                const text = element.textContent.trim();
                // Если текст содержит пробелы или короткий, разрешаем нормальный перенос
                if (text.includes(' ') || text.length < 15) {
                    element.style.wordBreak = 'normal';
                    element.style.overflowWrap = 'break-word';
                } else {
                    // Для длинных текстов без пробелов
                    element.style.wordBreak = 'break-word';
                    element.style.overflowWrap = 'anywhere';
                }
            });

            // Для содержимого блоков - увеличиваем максимальную ширину
            rowBlockContents.forEach(block => {
                block.style.minWidth = '0';
                block.style.overflowWrap = 'break-word';
                // Увеличиваем максимальную ширину для лучшего переноса
                block.style.maxWidth = 'calc(100% - 40px)';
            });

            // Специально для номера автобуса - увеличиваем максимальную ширину
            if (busElement) {
                busElement.style.maxWidth = '100%';
                busElement.style.display = 'inline-block';
                busElement.style.wordBreak = 'break-word';
                busElement.style.overflowWrap = 'break-word';

                // Увеличиваем шрифт для длинных текстов
                if (busElement.textContent.length > 10) {
                    busElement.style.fontSize = '22px';
                    busElement.style.lineHeight = '1.3';
                }
            }

            // Автоматически прокручиваем к активному табу если нужно
            const activeTab = document.querySelector('.tab.active');
            if (activeTab) {
                const tabsContainer = document.querySelector('.tabs-container');
                const tabOffset = activeTab.offsetLeft - tabsContainer.offsetWidth / 2 + activeTab.offsetWidth / 2;
                tabsContainer.scrollLeft = tabOffset;
            }
        }

        // Инициализация таймера
        let timeLeft = 15;
        const timerElement = document.getElementById('timer');

        const countdown = setInterval(() => {
            timeLeft--;
            timerElement.textContent = timeLeft;

            if (timeLeft <= 0) {
                clearInterval(countdown);
                tg.close();
            }
        }, 1000);

        // Обработка кнопки закрытия
        document.getElementById('closeButton').addEventListener('click', function() {
            tg.close();
        });

        // Обработка кнопки "Назад" в Telegram
        tg.BackButton.onClick(function() {
            tg.close();
        });

        tg.BackButton.show();

        // Обработка переключения табов
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');

                // Прокручиваем к выбранному табу
                const tabsContainer = document.querySelector('.tabs-container');
                const tabOffset = tab.offsetLeft - tabsContainer.offsetWidth / 2 + tab.offsetWidth / 2;
                tabsContainer.scrollLeft = tabOffset;
            });
        });

        // Вызываем функцию настройки переноса текста
        window.addEventListener('load', adjustTextWrapping);
        window.addEventListener('resize', adjustTextWrapping);

        tg.ready();
    </script>
</body>
</html>